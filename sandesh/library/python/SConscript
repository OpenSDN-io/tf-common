# -*- mode: python; -*-

#
# Copyright (c) 2013 Juniper Networks, Inc. All rights reserved.
#

import os

Import('SandeshEnv');

env = SandeshEnv.Clone();

base_path = '#src/contrail-common/sandesh/library/python/pysandesh/'
# Auto-generated SandeshHeader package
sandesh_hdr_pkg = env.SandeshGenPy('#src/contrail-common/sandesh/library/common/sandesh.sandesh', base_path)
# Auto-generated Sandesh Ctrl package
sandesh_ctrl_pkg = env.SandeshGenPy('#src/contrail-common/sandesh/library/common/sandesh_ctrl.sandesh', base_path)
# Auto-generated Sandesh UVE package
sandesh_uve_pkg = env.SandeshGenPy('#src/contrail-common/sandesh/library/common/sandesh_uve.sandesh', base_path)
# Auto-generated Sandesh Alarm package
sandesh_alarm_pkg = env.SandeshGenPy('#src/contrail-common/sandesh/library/common/sandesh_alarm.sandesh', base_path)
# Auto-generated Sandesh Trace package
sandesh_trace_pkg = env.SandeshGenPy('#src/contrail-common/sandesh/library/common/sandesh_trace.sandesh', base_path)
# Auto-generated derived stats
ds_pkg = env.SandeshGenPy('#src/contrail-common/sandesh/library/common/derived_stats_results.sandesh', base_path + 'gen_py/sandesh_uve/', False)
env.Depends(ds_pkg, sandesh_uve_pkg)
# Generate the io files and install in sandesh_uve
io_pkg = env.SandeshGenPy('#src/contrail-common/io/io.sandesh', base_path + 'gen_py/sandesh_uve/', False)
env.Depends(io_pkg, sandesh_uve_pkg)
# Auto-generated Connection Info package
process_info_pkg = env.SandeshGenPy('#src/contrail-common/base/sandesh/process_info.sandesh', base_path)

test_path = base_path + 'test/'
gen_test_pkg = env.SandeshGenPy('pysandesh/test/encode_decode_test.sandesh', test_path)
gen_test_pkg += env.SandeshGenPy('pysandesh/test/msg_test.sandesh', test_path)
gen_test_pkg += env.SandeshGenPy('pysandesh/test/sandesh_http_test.sandesh', test_path)
gen_test_pkg += env.SandeshGenPy('pysandesh/test/uve_alarm_test.sandesh', test_path)
gen_test_pkg += env.SandeshGenPy('#src/contrail-common/sandesh/library/common/sandesh_alarm_base.sandesh', test_path)
gen_test_pkg += env.SandeshGenPy('#src/contrail-common/base/sandesh/nodeinfo.sandesh', test_path)
gen_test_pkg += env.SandeshGenPy('#src/contrail-common/base/sandesh/process_info.sandesh', test_path + 'gen_py/nodeinfo/', False)
gen_test_pkg += env.SandeshGenPy('#src/contrail-common/base/sandesh/cpuinfo.sandesh', test_path + 'gen_py/nodeinfo/', False)

sdist_depends = [
    sandesh_hdr_pkg, sandesh_ctrl_pkg, sandesh_uve_pkg,
    sandesh_alarm_pkg, sandesh_trace_pkg,
    io_pkg, ds_pkg, process_info_pkg, gen_test_pkg]

sdist_gen = env.Command(
    '/pip/sandesh-0.1.dev0-py3-none-any.whl', 'setup.py',
    'cd ' + Dir('#src/contrail-common/sandesh/library/python').path + ' && python3 setup.py bdist_wheel --dist-dir /pip')
env.Depends(sdist_gen, sdist_depends)
env.Alias('install', sdist_gen)
env.Alias('sandesh/library/python:pysandesh', sdist_gen)

env.SetupPyTestSuiteWithDeps(sdist_depends, top_dir=base_path)
